<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="chan.artwork">

    <select id="save" parameterType="map">
INSERT INTO san_artwork(
			`FILE_NAME`,
			`SAN_CODE`,
			`FILE_SIZE`,
			`FILE_FORMAT`,
			`POST_DATE`,
			`RATING`,
			`RESOLUTION_RATIO`,
			`STATUS`,
			`RELATIVE_PATH`,
			`CREATE_TIME`,
			`UPDATE_TIME`,
			`INFORMATION`,
			`OFFICIAL`,
			`BOOK_ID`,
			`PARENT_ID`,
			`IS_SINGLE`,
			`STORE_PLACE`
			) VALUES (
			#{fileName},
			#{sanCode},
			#{fileSize},
			#{fileFormat},
			#{postDate},
			#{rating},
			#{resolutionRatio},
			#{status},
			#{relativePath},
			now(),
			now(),
			#{information},
			#{official},
			#{bookId},
			#{parentId},
			#{isSingle},
			#{storePlace}
			) ON DUPLICATE KEY UPDATE `BOOK_ID` = #{bookId} , `PARENT_ID` = #{parentId}
		</select>
	<select id="getArtistNameBySanCode" parameterType="String" resultType="String">
		SELECT
 SAT.`name`
FROM
	san_artwork SA
JOIN artwork_artist_rel AAR ON SA.san_code = AAR.san_code
JOIN san_artist SAT ON AAR.artist_id = SAT.artist_id
WHERE
	SA.san_code = #{sanCode} and SAT.is_target = 1;
	</select>
	<select id="getArtistNameByFileName" parameterType="String" resultType="String">
		SELECT
 SAT.`name`
FROM
	san_artwork SA
JOIN artwork_artist_rel AAR ON SA.san_code = AAR.san_code
JOIN san_artist SAT ON AAR.artist_id = SAT.artist_id
WHERE
	SA.file_name = #{fileName} ;
	</select>
	<select id="getArtistParentSanCodeToCheck" parameterType="String" resultType="String">
		SELECT
        	SAR.san_code
        FROM
        	san_artist SAT
        JOIN artwork_artist_rel AAR ON SAT.artist_id = AAR.artist_id
        JOIN san_artwork SAR ON SAR.san_code = AAR.san_code
         WHERE
         	SAR.store_type = 1
         AND
          	(
          		SAR.parent_id = -1
         		OR SAR.parent_id = -2
         		OR SAR.parent_id IS NULL
          	)
          AND SAT.`name` = #{artistName}
          AND (SAR.book_id &lt; 0 OR SAR.book_id IS NULL)
	</select>
	<update id="updateParentId" parameterType="Map">
		update san_artwork set parent_id = #{parentId} where san_code = #{sanCode}
	</update>
	<update id="updateBookId" parameterType="Map">
		update san_artwork set book_id = #{bookId} where san_code = #{sanCode}
	</update>
	<update id="markAsVip" parameterType="String">
		update san_artwork set store_type = 7 where san_code = #{sanCode};
	</update>
	<update id="markAsSkip" parameterType="Map">
		update san_artwork set parent_id = #{parentId} where san_code = #{sanCode};
	</update>
	<update id="markDeleted" parameterType="String">
		update san_artwork set store_type = 6 where san_code = #{sanCode};
	</update>
	<select id="getMarkDel">
		select file_name from san_artwork join artwork_artist_rel
	</select>
</mapper>
