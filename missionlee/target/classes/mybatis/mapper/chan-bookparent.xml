<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="chan.book">
    <insert id="saveBookInfo" parameterType="pers.missionlee.chan.pojo.BookInfo">
        insert into san_book(
			id,
			`name`,
			created_at,
			updated_at,
			artist_id,
			post_count,
			visible_post_count,
			rating,
			information,
			stored_artist_name
		)values(
			#{id},
			#{name},
			#{createdAt},
			#{updatedAt},
			#{artistId},
			#{postCount},
			#{visiblePostCount},
			#{rating},
			#{information},
			#{storedArtistName}
		)
    </insert>
	<select id="getStoreArtistById" resultType="String" parameterType="integer">
		select stored_artist_name from san_book where id = #{id}
	</select>
	<select id="updateBookArtist">
		update san_book set stored_artist_name = #{artistName} where id = #{bookId}
	</select>
<!-- !!!!!!!!! 下面是  parent 相关的内容 ！！！！	-->
   <!-- 查询-->
	<select id="getArtistParentIdStoredPart" parameterType="String" resultType="String">
SELECT
	san_parent.id
FROM
	san_parent
JOIN parent_artist_rel ON san_parent.id = parent_artist_rel.parent_id
JOIN san_artist ON parent_artist_rel.artist_id = san_artist.artist_id
WHERE san_artist.`name` = #{artistName} and (san_parent.`status` = 0 OR san_parent.`status` = 2)
	</select>
	<select id="bookIdExists" resultType="Integer" parameterType="Integer">
		select count(*) from san_book where id = #{bookId}
	</select>
</mapper>
